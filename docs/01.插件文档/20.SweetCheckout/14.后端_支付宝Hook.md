---
title: 后端部署 支付宝Hook
date: 2025-01-29 11:29:02
permalink: /docs/checkout/install/backend/alipay-hook
---

# 支付宝 Hook配置

实现的支付宝 Hook 运行在支付宝开放平台上，不需要额外下载任何 Hook 软件。

## 配置开放平台

你需要有一个与 [支付宝开放平台](/docs/checkout/install/backend/alipay) 配置教程一样，先创建好网页应用，配置方式大体相同，原本是配置这几个项

```json5
{
    "alipay_face2face": {
        "enable": false,
        "app_id": "20xxxxxxxxxxx2",
        "private_key": "file:secrets/alipay/private.txt",
        "alipay_public_key": "file:secrets/alipay/public.txt",
        "produce_code": "QR_CODE_OFFLINE",
    },
}
```

将 `app_id`、`private_key`、`alipay_public_key` 给复制到 `hook.alipay` 之后，再获取 `seller_id` 并输入进去即可。

> `seller_id` 可以到[开放平台的这个页面](https://open.alipay.com/platform/keyManage.htm?keyType=partner)获取，复制 `合作伙伴身份（PID）` 就是了。

改完后把 Hook 那边的 `enable` 的值改为 `true` 以便开启 Hook。

```json5
{
    "hook": {
        "enable": true,
        "alipay": {
            "enable": true,
            "app_id": "20xxxxxxxxxxx2",
            "seller_id": "20xxxxxxxxxxxxxx4",
            "private_key": "file:secrets/alipay/private.txt",
            "alipay_public_key": "file:secrets/alipay/public.txt",
            // 指定收款码地址
            "payment_url": "https://qr.alipay.com/2m611859woopehfqucwqwb2",
            "payment_urls": {
                "1.00": "示例，1元的经营收款码地址"
            }
        }
    }
}
```

## 经营收款码

在支付宝首页点击`收付款`，点击`收钱`，点击`经营收钱`，再保存图片，即可保存一张`经营收款码`。

**注意，一定要用经营收款码，个人收款码是无法被开放平台监听到的！**

将这张经营收款码上传到 [这个工具网站](https://cli.im/deqr/) 即可获得收款码地址。当然你也可以用其它工具，能解码二维码就行了。

复制解码结果，粘贴到 `payment_url`，就跟上面示例的一样
```json5
"alipay": {
    "payment_url": "https://qr.alipay.com/2m611859woopehfqucwqwb2"
}
```

接下来继续保存收款码，保存之前设置金额，比如设置 `1.00`, `6.00`, `32.00` 等金额，你需要什么金额就保存什么金额的收款码，然后以相同的方法输入到 `payment_urls`，注意金额**必须保留两位小数**。这与微信 Hook 的配置方式相同。

设置 `payment_urls` 之后，当玩家下单指定金额的订单时，就不需要玩家手动再在支付宝输入一次金额了。

> 记得重启后端或者执行 `reload` 重载配置。

完成配置后，下单1块钱测试是否正常使用即可。

## 注意事项

后端是按金额来匹配支付人的，同一时间内，不能有多个人创建同一金额的订单。

比如不能有两个玩家同时充值 1 元，后面来的玩家，必须要等前面的玩家支付完成才能创建订单。

同时有多个人创建 1 元、6 元、32 元的订单是允许的。
