---
title: 开发者
date: 2025-09-01 17:59:14
permalink: /docs/playermarket/dev
sponsorship: true
---

[![jitpack](https://jitpack.io/v/MrXiaoM/SweetPlayerMarket.svg)](https://jitpack.io/#MrXiaoM/SweetPlayerMarket)

```kotlin
repositories {
    maven("https://jitpack.io/")
}
dependencies {
    compileOnly("com.github.MrXiaoM:SweetPlayerMarket:$VERSION:all")
}
```

## 上架商品

这是需要访问数据库的方法，请自觉异步调用，不要在主线程上执行。

```java
// 获取经济实现
IEconomy vault = SweetPlayerMarket.getInstance().parseEconomy("Vault");
if (vault == null) {
    throw new Exception("找不到 Vault 经济");
}

// 获取开发者接口实例
MarketAPI api = SweetPlayerMarket.api();
// 上架物品
MarketItem item = api.deploy(player, builder -> {
    builder.type(EnumMarketType.SELL)    // 出售类型
           .currency(vault)             // 使用 Vault 经济
           
           // !!!!!!!!!!!!!!! 注意 !!!!!!!!!!!!!!
           // item 的数量跟 amount 不是一回事
           // 【item.getAmount() 是单份商品数量】
           // 【amount 是商品总份数】
           // 最终玩家出售的物品数量为 item.getAmount() * amount
           .item(player.getItemInHand()) // 确定一份物品是怎样的
           .amount(1)                    // 总份数

           .price(100.0);                // 单份物品出售价格
});
```

## 添加扩展商品类型

详见接口 [IShopAdapterFactory](https://github.com/MrXiaoM/SweetPlayerMarket/blob/main/src/main/java/top/mrxiaom/sweet/playermarket/api/IShopAdapterFactory.java)，主要用途是自定义特殊商品的出售和收购逻辑。

也就是说，出售商品在给物品的时候可以不给物品，转而执行自定义操作。收购商品同理。

```java
import top.mrxiaom.sweet.playermarket.func.ShopAdapterRegistry;

// 注册商店适配器工厂到 SweetPlayerMarket 中
ShopAdapterRegistry.inst().register(factory);
```

## 添加物品提供器

指的是在自动上架配置中，`market-item.item-source` 字段使用物品提供器。（未来这个物品提供器可能会有其它用途）

默认支持原版物品和 MythicMobs 物品，即直接输入物品 ID 或者使用 `mythic:物品` 格式。

```java
import top.mrxiaom.sweet.playermarket.SweetPlayerMarket;

// 获取插件实例
SweetPlayerMarket plugin = SweetPlayerMarket.getInstance();
// 注册物品提供器
plugin.registerItemProvider(provider);
```

## 修改商品标签提供器

> 目前正在编写默认实现 [ItemTagManager](https://github.com/MrXiaoM/SweetPlayerMarket/blob/main/src/main/java/top/mrxiaom/sweet/playermarket/func/ItemTagManager.java)。

用于给不同商品打标签，使得玩家可以在全球市场列表筛选出指定标签的商品，实现分类功能。

```java
import top.mrxiaom.sweet.playermarket.SweetPlayerMarket;

// 获取插件实例
SweetPlayerMarket plugin = SweetPlayerMarket.getInstance();
// 设置商品标签提供器
plugin.itemTagResolver(provider);
```

如果目标商品不符合你的要求，需要调用默认的标签提供器以确保分类能够正常工作
```java
import top.mrxiaom.sweet.playermarket.data.MarketItem;
import top.mrxiaom.sweet.playermarket.func.ItemTagManager;

@Override
public @Nullable String resolve(@NotNull MarketItem item) {
    // TODO: 你的标签提供逻辑
    if (...) {
        return "tag";
    }
    // 不符合你的条件，使用默认标签提供器代替
    return ItemTagManager.inst().resolve(item);
}
```
